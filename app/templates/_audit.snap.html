<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/jquery.dataTables.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    {% if embed_local_assets %}
    <style>
        {{ get_static_file("css/light.css") | safe }}
        @import url('https://fonts.googleapis.com/css2?family=Recursive+Mono:ital,wght@0,400;0,600;1,400;1,600&display=swap');
    </style>
    {% else %}
    <link rel="stylesheet"
          href="{{ url_for('static', filename='css/light.css') }}">
    {% endif %}

    <style>
        pre, code, textarea {
            font-family: 'Recursive Mono', 'JetBrains Mono', Consolas, 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
        }
    </style>

    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>

    {% if embed_local_assets %}
    <script>
        {{ get_static_file("js/audit.results.device.js") | safe }}
    </script>
    {% else %}
    <script src="{{ url_for('static', filename='js/audit.results.device.js') }}"></script>
    {% endif %}
</head>
<body>
<div class="layout">
    <main>
        <div style="
            padding: 4px;
            border-bottom: 1px solid #ddd;
            font-size: 12px;
            background-color: #f9f9f9;
            display: flex;
            justify-content: space-between;
            ">
            <span>{{ report_filename }}</span>
            <span>Generated on {{ generated_at.strftime('%d %b %Y %H:%M') }}</span>
        </div>
        <section class="content">
            <div class="content" style="height: auto; overflow: visible;">
                <h4>Device</h4>
                <div style="display: flex; flex-direction: row; gap: 20px; margin-top: 10px;">

                    <table class="device-infotable">
                        <tbody>
                        <tr>
                            <th>Hostname</th>
                            <th>Date Added</th>
                            <th>Last Audit</th>
                            <th>Login</th>
                            <th>Overall</th>
                        </tr>
                        <tr>
                            <td>{{ device_data.hostname }}</td>
                            <td>{{ date_added }}</td>
                            <td>{{ last_audit }}</td>
                            <td>
                                {% if device_data.login is true %}
                                <span class="badge status-pass"><i class="fas fa-check-circle"></i>SUCCESS</span>
                                {% elif device_data.login is false %}
                                <span class="badge status-fail"><i class="fas fa-times-circle"></i>FAILED</span>
                                {% else %}
                                <span class="badge status-notrun"><i class="fas fa-minus-circle"></i>UNKNOWN</span>
                                {% endif %}
                            </td>

                            <td class="text-center">
                                {% set status = status_codes.get(device_data.status) %}
                                <span class="badge status-{{ status.label | lower | replace(' ', '') }}"
                                      title="{{ status.description }}">
                                    <i class="fas {{ status.icon }}"></i>
                                    {{ status.label }}
                                </span>
                            </td>
                        </tr>
                        </tbody>

                    </table>
                </div>

                <h4 style="margin-bottom: 5px;">Audit</h4>
                <table id="device-resulttable" class="display" style="width: 100%;">
                    <thead>
                    <tr>
                        {% for col in columns %}
                        <th>{{ col }}</th>
                        {% endfor %}
                    </tr>
                    </thead>
                    <tbody>
                    {% for data_item in dataset %}
                    <tr>
                        {% for col in columns %}
                        {% if col == "Status" %}
                        <td>
                            {% set status = status_codes.get(data_item[col], status_codes[0]) %}
                            <span class="badge status-{{ status.label | lower | replace(' ', '')  }}"
                                  title="{{ status.description }}">
                        <i class="fas {{ status.icon }}"></i>
                        <span>{{ status.label }}</span>
                    </span>
                        </td>
                        {% else %}
                        <td style="white-space: pre-wrap;">{{ data_item[col] | safe }}</td>
                        {% endif %}
                        {% endfor %}
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>

                <h4 style="margin: 14px 0 10px 0;">Logs</h4>
                <div style="background-color: #f5f5f5;">
                    {% for cmd, output in device_data.raw.items() %}
                    {% set cmd_parts = cmd.split(':') %}
                    {% if cmd_parts[0] == device_id %}
                    <h5 style="margin:12px 8px;">{{ cmd_parts[1] }}</h5>
                    {% else %}
                    <h5 style="margin:12px 8px;">{{ cmd }}</h5>
                    {% endif %}
                    <pre style="margin:0; background-color:#fff;">{{ output }}</pre>
                    {% endfor %}
                </div>
            </div>
        </section>
    </main>
</div>
</body>
</html>